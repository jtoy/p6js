<title>p6 - scratchpad</title>
<style>
#container{
  display:flex;
  flex-direction:row;
  justify-content: space-around;
}
#editor{
  display:flex;
  float:left;
  flex-direction:column;
}
#side{
  display:flex;
  float:right;
  flex-direction:column;
}
body {background-color: powderblue;}
html {
  overflow-x: hidden;
}

#box {
  position: fixed;
  height: 100%;
  width: 50%;
  padding-top: 20px;
}

.preview-text img {
  max-width: 100%;
  max-height: 100%;
}

</style>
<link rel="stylesheet" type="text/css" href="stylesheets/spectrum.css">

  <div id="play">play</div>
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script src="js/jquery-3.1.1.min.js"></script> 
  <script src="js/underscore-min.js"></script> 
  <script src='js/spectrum.js'></script>
  <script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
  <div>
    <div id="editor">
      <pre id="box" >
  function setup(){
  }

  function draw(){
  }
      </pre>
   </div>
   <div id="side">
     side
     <div id="line">CURRENT LINE</div>
     <input id='colorpicker' />
     <div id="rgb"></div>
  </div>
</div>


<script>
if (window.module) module = window.module;
const ipc = require('electron').ipcRenderer

$("#colorpicker").spectrum({
  color: "#f00",
  showButtons: false,
  change: function(color) {
    $("#rgb").text(color.toRgbString());
  }
});

var editor = ace.edit("box");
editor.setTheme("ace/theme/github");
editor.session.setMode("ace/mode/javascript");
var code = editor.getValue()

ipc.on('file-contents', (event, contents) => {
  editor.setValue(contents);
});

$("#box").on('keyup click',function() {
  if(code != editor.getValue()){
    var new_code = editor.getValue()
    ipc.send('async_save_scratch_or_global_file', new_code);
    code = new_code
    var currline = editor.getSelectionRange().start.row;
    var line = editor.session.getLine(currline);
    $("#line").text(line)
  }
});

var fs = require('fs');
$("#play").on('click',function(){
  ipc.send('asynchronous_load_scratch', 'ping')
});

ipc.on('getSaveAs', (event, fileData) => {
  ipc.send('fileSaveAs', editor.getValue());
});



</script>
